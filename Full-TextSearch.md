---
tags:  
  - DB  
  - FTS  
  - MariaDB
  - LIKE
  - INDEX
---
#TIL   
# 개요  
**대량의 텍스트 데이터에서 특정 단어나 문구를 빠르고 효과적으로 찾아내는 검색 기술.**    
문서 또는 데이터베이스에서 전체 텍스트를 대상으로 검색을 수행하는 방법. 문서의 모든 단어를 인덱싱하고, 사용자의 질의어가 포함된 문서를 빠르게 찾을 수 있다.  
***  
# 구성 요소  
* **Indexer**  
    * 텍스트 데이터를 검색 할 수 있는 인덱스로 변환.  
    * 원본 데이터에서 검색 키워드를 추출하고, 위치, 빈도 등의 메타데이터와 함께 저장.  
    * ex) "John loves pizza and Mary loves pasta"  
       * 문장을 토큰화  
       * 'John', 'loves', 'pizza', 'and', 'Mary', 'pasta'  
    ***  
* **Query Processor**  
    * 사용자의 검색 요구를 분석하고, 인덱스가 이해할 수 있는 형태로 변환.  
    * 쿼리의 단어를 소문자 변화, 불용어 제거, 어근 추출, 형태소 분석, 동의어 처리, 표현식 확장 등 과 같은 정규화 진행.  
    ***  
* **Search Engine**  
    * 인덱스를 사용하여 실제 데이터를 검색.  
    ***  
* **Relevance Ranking**  
    * 검색 결과의 관련성을 평가하고 있는 순위를 매기는 과정.  
    * 키워드의 빈도, 위치, 문서의 신선도, 사용자의 행동 등 다양한 요인을 고려.  
    ***  
# MariaDB
## 사용 방법 
Ref:   
[MariaDB Full-Text Index Overview](https://mariadb.com/kb/en/full-text-index-overview/#in-natural-language-mode)   
* **구문**
    * **MATCH (col1,col2,...) AGAINST (expr [search_modifier])**
    * search_modifier  
       * **IN NATURAL LANGUAGE MODE**  
          * 키워드 생략 가능.  
          * 관련성이 높은 순서대로 반환.  
          ***  
       * **IN BOOLEAN MODE**  
          * 특수 연산자로 검색 옵션 부여.
             * ' + ' : 반환된 모든 행에서 해당 단어는 필수.
             * ' - ' : 해당 단어는 반환된 행에 나타날 수 없다.
             * ' > ' : 가중치를 증가시킨다. 
             * ' < ' : 가중치를 감소시킨다. ex) '<MySQL'
             * ' ~ ' : 관련성에 부정적으로 기여.
             * ' * ' : 와일드카드로, 단어의 끝에 작성.
             * ' " ' : 큰따옴표로 묶인 내용은 전체로 간주. 
          * 검색어는 관련성 순으로 반환되지 않고 50% 제한도 적용되지 않는다.  
          ***  
       * **WITH QUERY EXPANSION**  
          * 자연어 검색의 변형.  
          * 일반적인 자연어 검색을 수행하고, 검색에서 반환된 가장 관련성이 높은 행의 단어가 검색 문자열에 추가되고 검색이 다시 수행되어 두 번쨰 검색의 행을 반환.
		  *** 
* **매치율**
	* **SELECT match( _col_ ) AGAINST ( _expr_ ) AS score,  FROM _Table_;**
	* 단어의 수, 행의 고유 단어 수, 인덱스와 결과의 총 단어 수, 가중치 등 을 기반으로 관련성을 계산.
	* 점수가 높을 수록 검색 결과와 일치도가 높다.
	***
# 관련 내용
##### LIKE 연산자와 와일드 카드
==LIKE Keyword%== 와 같이 와일드 카드가 문자열의 시작에 사용되지 않은 경우, 실행 계획을 살펴보면 인덱스 검색을 수행할 수 있다. 하지만 ==LIKE %Keyword%== 및 ==LIKE %Keyword== 와 같이 와일드 카드가 문자열의 시작에 존재하는 경우 일반적으로 인덱스를 사용할 수 없어 **전체 테이블 또는 전체 인덱스 스캔이 발생할 수 있다.**  

이는 대부분의 관계형 데이터베이스에서 사용 되는 _B-tree_ 인덱스가 데이터를 키 값의 앞부분부터 사전식으로 정렬하여 저장하기 때문에, 와일드 카드가 문자열의 시작에 위치하면 시작 지점을 결정할 수 없어 모든 데이터를 확인해야 하기 때문이다.  

##### DB 의 전문 검색과 파서
세부적인 검색을 위해 텍스트를 더 작은 단위로 분할하고 의미 있는 토큰으로 분류할 수 있는 '파서'를 사용할 수 있다. 특히 CJK(중국어, 일본어, 한국어)와 같이 단어의 경계가 명확하지 않은 언어를 사용한다면 더욱 유용하다.  
MySQL 의 내장 파서 'n-gram' 은 텍스트를 연속된 n 개의 문자로 분할하고 인덱스로 저장하는 방식을 사용하고, MariaDB 에서는 내장 파서가 없지만 'Mroonga' 플러그인을 통해 유사한 기능을 사용할 수 있다. 'TokenBigram' 과 같이 토크나이저를 설정하면, 텍스트를 연속적인 두 문자의 조합으로 분할하여 인덱스로 저장 한다.
***